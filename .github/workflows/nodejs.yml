name: 单元测试 & 部署gh-pages
on:
  push:
    branches:
      - master
  pull_request:
      branches: [ master ]
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master
    - name: Build
      run:
        npm i
        npm run build
        npm run test
      
  deploy-to-gh-pages:
    needs: [build-and-test]
    runs-on: ubuntu-latest
    steps:
    - name: Deploy
      uses: JamesIves/github-pages-deploy-action@master
      env:
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        BRANCH: gh-pages
        FOLDER: dist
        BUILD_SCRIPT: npx stylus ./dist/main.styl & echo "demo.costream.org" >> dist/CNAME
